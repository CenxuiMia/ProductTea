<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta charset="UTF-8">
    <title>產品頁面</title>
    <!--[if IE 8]>
    <script type="text/javascript" src="build/ie8.js"></script>
    <![endif]-->
    <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    <link href="build/Squire-UI.css" rel="stylesheet" type="text/css" />
    <link href="dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="dist/css/fileinput.min.css" rel="stylesheet" type="text/css">
    <script src="auth.js"></script>
    <script src="build/jQuery/jQuery.js" type="text/javascript"></script>
    <script src="build/squire.js" type="text/javascript"></script>
    <script src="build/Squire-UI.js" type="text/javascript"></script>
    <script src="dist/js/fileinput.min.js" type="text/javascript"></script>

</head>
<body>



<div class="container">

    <nav>
        <input id="productName" placeholder="productName">
        <div></div>
        <input id="version" placeholder="version">
        <div></div>
        <input id="price" placeholder="price">
        <div></div>
        <input id="originalPrice" placeholder="originalPrice">
        <div></div>
        <input id="introduction" placeholder="introduction">
        <div></div>
        <input id="tag" placeholder="tag">
        <div></div>
        <input id="smailImage" placeholder="smailImage">
        <div></div>
        <input id="images" placeholder="images">

    </nav>


    <div class="row">
        <div class="col-centered">
            <label for="detail">detail</label>
            <textarea id="detail"></textarea>
        </div>
    </div>

    <form enctype="multipart/form-data">
        <br>
        <div class="file-loading">
            <input id="file" class="file" type="file" multiple data-min-file-count="1">
        </div>
        <br>
        <button type="button" class="btn btn-primary">Submit</button>
        <button type="reset" class="btn btn-default">Reset</button>
    </form>

    <div></div>

</div>
</body>

<style>
    nav {
        float: left;
        max-width: 160px;
        margin: 0;
        padding: 1em;
    }

</style>

<script>

    $(document).ready(function () {
        detail = new SquireUI({replace: 'textarea#detail', height: 200});
    });

    function updateProduct() {
        console.info(detail.getHTML())

        let product = {
            productName: document.getElementById("productName").value,
            version: document.getElementById("version").value,
            price: document.getElementById("price").value,
            originalPrice: document.getElementById("originalPrice").value,
            introduction: document.getElementById("introduction").value,
            tag: document.getElementById("tag").value,
            smallImage: document.getElementById("smallImage").value,
            images: document.getElementById("images").value,
        }

        let productJson = JSON.stringify(product);

        console.info(productJson);

        $.ajax({
            type : 'PUT',
            url : productEndpoint + "/table",
            data : productJson,
            success : function(response) {
                console.info("success");
            },
            error : function(xhr, status, error) {
                console.log("error: " + error + ", status: " + status);

            }
        });

    }


    $(':file').on('change', function() {
        let len = this.files.length;

        for (let i =0; i< len ; i++) {
            let file = this.files[i];
            if (file.size > 50000) {
                alert("not allow over 50000");
            }
        }

        console.info( this.files.length)
    });

    $(':button').on('click', function() {
        updateProduct();

        let productName = document.getElementById("productName").value;
        let version = document.getElementById("version").value;


        let files = $('input[type=file]')[0].files;

        let  len = files.length;

        for (let i = 0; i<len ;i++) {
            let file = files[i];

            let url = productEndpoint + "/image/" + productName+ "/"+ version + "/" + file.name;

            var oReq = new XMLHttpRequest();
            oReq.open("POST", url, true);
            oReq.onload = function (oEvent) {
                console.info(oEvent)
            };

            var blob = new Blob([file]);

            oReq.send(blob)
        }

    });


</script>


</html>


